Got it working (was simpler than I thought), then resolved using a cool functional library called Ramda.

There's no regex magic, just some currying and careful placement of arguments to always put data last.

